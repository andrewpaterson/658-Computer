  Wed Jan  5 2022 17:59                                                Page 1


                     ***************************************
                     **      WDC 65C816 Macro Assembler   **
                     **                                   **
                     **     Version 3.49.1- Feb  6 2006    **
                     ***************************************

     1                        STARTUP SECTION
     2                        
     3                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     4                        
     5                        
     6                        FUNCTION_CALL MACRO SUBROUTINE, LOCAL_SIZE
     7                        	JSR SUBROUTINE
     8                        	PHA				;push accumulato
                    r
     9                        	PHX				;push x index
    10                        	PHY				;push y index
    11                        	PHD				;push direct pag
                    e
    12                        	PHP				;push processor 
                    status bits
    13                        	REP 	#$20	;16 bit memory
    14                        	LONGA	ON
    15                        	TSC				;transfer stack 
                    pointer to accumulator
    16                        	SEC				;carry = 1
    17                        	SBC 	LOCAL_SIZE	;accumulator = accumulat
                    or - LOCAL_SIZE - 1 + carry 
    18                        	TCS				;transfer accumu
                    lator to stack pointer
    19                        	DEC				;accumulator--
    20                        	TCD				;transfer accumu
                    lator to direct page
    21                        	ENDM
    22                        
    23                        FUNCTION_RETURN MACRO LOCAL_SIZE
    24                        	REP 	#$20	;16 bit memory
    25                        	LONGA	ON
    26                        	TSC
    27                        	CLC				;carry = 0
    28                        	ADC 	LOCAL_SIZE	;accumulator = accumulat
                    or + LOCAL_SIZE + carry 
    29                        	TCS
    30                        	PLP				;pull processor 
                    status bits
    31                        	PLD				;pull direct pag
                    e
    32                        	PLY
    33                        	PLX
    34                        	PLA
    35                        	RTS				;return from sub
                    routine
    36                        	ENDM
    37                        	
    38                        	ORG $8000
    39                        START:
    40 00:8000: AD FC FF     	LDA		$FFFC
    41 00:8003: C9 2B E1     	CMP		#$E12B
  Wed Jan  5 2022 17:59                                                Page 2


    42                        	
    43 00:8006: F0 02        	BEQ		ABSOLUTE_LONG_READ_OKAY
    44 00:8008: 00 00        	BRK
    45                        ABSOLUTE_LONG_READ_OKAY:
    46                        
    47 00:800A: E2 20        	SEP		#$20	;8 bit memory
    48                        	LONGA	OFF
    49                        
    50 00:800C: AD FC FF     	LDA		$FFFC
    51 00:800F: C9 2B        	CMP		#$2B
    52                        	
    53 00:8011: F0 02        	BEQ		ABSOLUTE_SHORT_READ_OKAY
    54 00:8013: 00 00        	BRK
    55                        ABSOLUTE_SHORT_READ_OKAY:
    56                        	
    57 00:8015: A9 E4        	LDA		#$e4
    58 00:8017: 8D 00 F0     	STA		$F000
    59                        	
    60 00:801A: A9 CC        	LDA		#$CC
    61 00:801C: AD 00 F0     	LDA		$F000
    62                        
    63 00:801F: A9 FF        	LDA		#$FF	;user program 0 (0xFF - 
                    user program ID)
    64 00:8021: 8D 00 FB     	STA		$FB00
    65                        	
    66 00:8024: A9 02        	LDA		#$02
    67 00:8026: 8F 00 FF 01  	STA		$01FF00	;remap user progream 0xF
                    F, bank 0x00 to real bank 0x02
    68 00:802A: A9 03        	LDA		#$03
    69 00:802C: 8F 01 FF 01  	STA		$01FF01	;remap user progream 0xF
                    F, bank 0x01 to real bank 0x03
    70                        	
    71 00:8030: A9 00        	LDA		#$00
    72 00:8032: 48           	PHA				;push progream c
                    ounter bank
    73 00:8033: A9 04        	LDA		#$04
    74 00:8035: 48           	PHA				;push progream c
                    ounter high-byte
    75 00:8036: A9 1C        	LDA		#$1C
    76 00:8038: 48           	PHA				;push progream c
                    ounter low-byte
    77 00:8039: 08           	PHP				;push processor 
                    status
    78                        
    79 00:803A: C2 20        	REP		#$20	;16 bit memory
    80                        	LONGA	ON
    81                        	
    82 00:803C: 40           	RTI
    83                        
    84                        
    85                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
    86                        	
    87                        	ORG $E12B
    88                        RESET:
    89 00:E12B: 18           	CLC	     		;clear carry
    90 00:E12C: FB           	XCE	     		;clear emulation
    91 00:E12D: C2 30        	REP		#$30    ;16 bit registers
    92                        	LONGI 	ON
  Wed Jan  5 2022 17:59                                                Page 3


    93                        	LONGA	ON
    94 00:E12F: A9 FF 01     	LDA		#$01FF  ;get the stack address
    95 00:E132: 1B           	TCS	     		;and set the stack to it
    96                        
    97 00:E133: E2 20        	SEP		#$20	;8 bit memory
    98                        	LONGA 	OFF
    99 00:E135: A9 00        	LDA 	#$00	;get bank of data
   100 00:E137: 48           	PHA
   101 00:E138: AB           	PLB	     		;set data bank register
   102 00:E139: C2 20        	REP		#$20    ;back to 16 bit mode
   103                        	LONGA	ON
   104                        
   105 00:E13B: 5C 00 80 00  	JML  	START	;long jump in case not bank 0
   106                        
   107                        IRQ:
   108 00:E13F: 8B           	PHB				;save DB
   109 00:E140: 0B           	PHD				;save DP
   110 00:E141: C2 30        	REP		#$30	;16 bit registers
   111                        	LONGI 	ON
   112                        	LONGA	ON
   113 00:E143: 48           	PHA				;save A
   114 00:E144: DA           	PHX				;save X
   115 00:E145: 5A           	PHY 			;save Y
   116                        	
   117 00:E146: 80 2D        	BRA 	EXIT_INTERRUPT 
   118                        
   119                        NMI:
   120 00:E148: 8B           	PHB				;save DB
   121 00:E149: 0B           	PHD				;save DP
   122 00:E14A: C2 30        	REP		#$30	;16 bit registers
   123                        	LONGI 	ON
   124                        	LONGA	ON
   125 00:E14C: 48           	PHA				;save A
   126 00:E14D: DA           	PHX				;save X
   127 00:E14E: 5A           	PHY 			;save Y
   128                        
   129 00:E14F: 80 24        	BRA 	EXIT_INTERRUPT 
   130                        
   131                        ABORT:
   132 00:E151: 8B           	PHB				;save DB
   133 00:E152: 0B           	PHD				;save DP
   134 00:E153: C2 30        	REP		#$30	;16 bit registers
   135                        	LONGI 	ON
   136                        	LONGA	ON
   137 00:E155: 48           	PHA				;save A
   138 00:E156: DA           	PHX				;save X
   139 00:E157: 5A           	PHY 			;save Y
   140                        
   141 00:E158: 80 1B        	BRA 	EXIT_INTERRUPT 
   142                        
   143                        COP:
   144 00:E15A: 8B           	PHB				;save DB
   145 00:E15B: 0B           	PHD				;save DP
   146 00:E15C: C2 30        	REP		#$30	;16 bit registers
   147                        	LONGI 	ON
   148                        	LONGA	ON
   149 00:E15E: 48           	PHA				;save A
   150 00:E15F: DA           	PHX				;save X
  Wed Jan  5 2022 17:59                                                Page 4


   151 00:E160: 5A           	PHY 			;save Y
   152                        
   153 00:E161: 80 12        	BRA 	EXIT_INTERRUPT 
   154                        
   155                        BRK:
   156 00:E163: 8B           	PHB				;save DB
   157 00:E164: 0B           	PHD				;save DP
   158 00:E165: C2 30        	REP		#$30	;16 bit registers
   159                        	LONGI 	ON
   160                        	LONGA	ON
   161 00:E167: 48           	PHA				;save A
   162 00:E168: DA           	PHX				;save X
   163 00:E169: 5A           	PHY 			;save Y
   164                        
   165 00:E16A: 80 09        	BRA 	EXIT_INTERRUPT 
   166                        
   167                        EMU:
   168 00:E16C: 8B           	PHB				;save DB
   169 00:E16D: 0B           	PHD				;save DP
   170 00:E16E: C2 30        	REP		#$30	;16 bit registers
   171                        	LONGI 	ON
   172                        	LONGA	ON
   173 00:E170: 48           	PHA				;save A
   174 00:E171: DA           	PHX				;save X
   175 00:E172: 5A           	PHY 			;save Y
   176                        
   177 00:E173: 80 00        	BRA 	EXIT_INTERRUPT 
   178                        
   179                        EXIT_INTERRUPT:
   180 00:E175: C2 30        	REP	#$30		;16 bit registers
   181                        	LONGI 	ON
   182                        	LONGA	ON
   183 00:E177: 7A           	PLY             ;restore Y
   184 00:E178: FA               PLX             ;restore X
   185 00:E179: 68               PLA             ;restore A
   186 00:E17A: 2B               PLD             ;restore DP
   187 00:E17B: AB               PLB             ;restore DB
   188 00:E17C: 40           	RTI
   189                        	
   190                        	
   191                        ; This section defines the interrupt and reset vec
                    tors.    
   192                        
   193                        	ORG	$FFE4
   194                        
   195 00:FFE4: 5A E1        N_COP   DW    COP
   196 00:FFE6: 63 E1        N_BRK   DW    BRK
   197 00:FFE8: 51 E1        N_ABORT DW    ABORT
   198 00:FFEA: 48 E1        N_NMI   DW    NMI
   199 00:FFEC: 00 00        N_RSRVD DW    0
   200 00:FFEE: 3F E1        N_IRQ   DW    IRQ
   201                        
   202                        	ORG	$FFF4
   203 00:FFF4: 6C E1        E_COP   DW    EMU
   204 00:FFF6: 00 00        E_RSRVD DW    0
   205 00:FFF8: 6C E1        E_ABORT DW    EMU
   206 00:FFFA: 6C E1        E_NMI   DW    EMU
   207 00:FFFC: 2B E1        E_RESET DW    RESET
  Wed Jan  5 2022 17:59                                                Page 5


   208 00:FFFE: 6C E1        E_IRQ   DW    EMU
   209                        
   210 01:0000:              	ENDS
   211                        	END


      Lines assembled: 211
      Errors: 0
